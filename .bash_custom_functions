# CUSTOM SHELL FUNCTIONS
init-ssh() {
  pkill ssh-agent
  eval $(ssh-agent -s)
  for key in $(find ${HOME}/.ssh/ -type f -name 'id_rsa*' ! -name '*pub' -perm 400); do
    ssh-add $key
  done
}

new-branch() {
  echo "$(whoami)-tmp-$(openssl rand -hex 8)"
}

cert-dates() {
  website="$1"
  openssl s_client -connect $website:443 </dev/null 2>/dev/null | openssl x509 -noout -dates
}

get-cert() {
  website="$1"
  openssl s_client -connect $website:443 </dev/null 2>/dev/null | openssl x509 -noout -text
}

pastebin() {
  local filename=$1
  local text="$(cat $1)"
  local api_key="$PASTEBIN_API_KEY"
  local paste_url="https://pastebin.com/api/api_post.php"
  local expire="1D"

  curl -X POST \
    -F "api_dev_key=${api_key}" \
    -F "api_paste_code=<$1" \
    -F 'api_option=paste' \
    -F "api_paste_expire_date=${expire}" \
    ${paste_url}
  echo
}

ipinfo() {
  curl https://ipinfo.io 2>/dev/null | jq "{ip: .ip, city: .city, region: .region, country: .country, timezone: .timezone}"
}

fromts() {
  local ts="$1"
  local len="$(echo -n $ts | wc -c)"

  if [ "$len" -eq "13" ]; then
    date -d@"$(echo $(($ts/1000)))"
  elif [ "$len" -eq "10" ]; then
    date -d@"$ts"
  else
    echo "Wrong timestamp"
  fi
}

ots() {
  local secret=$1
  local ttl=3600
  local user="$OTS_USER_NAME"
  local api_key="$OTS_API_KEY"
  local domain="https://eu.onetimesecret.com"

  secret=$(curl -X POST -u "$user:$api_key" -d "secret=$secret&ttl=$ttl" "$domain/api/v1/share" 2>/dev/null | jq -r .secret_key)
  echo "$domain/secret/$secret"
}


is-online() {
  local url="http://cp.cloudflare.com/generate_204"
  local timeout=${1:-1}
  local response=$(
    curl \
    --output /dev/null \
    --write-out "%{http_code}" \
    --max-time "$timeout" \
    --silent \
    "$url"
  )

  if [ "$response" = "200" ] || [ "$response" = "204" ]; then
    echo "Yep"
  else
    echo "Nope" && return 1
  fi
}

uncommit() {
  git reset --soft HEAD^
}

mkcd() {
  mkdir -p "$1"
  cd "$1"
}

uppered() {
  tr '[:lower:]' '[:upper:]'
}

lowered() {
  tr '[:upper:]' '[:lower:]'
}

timer() {
  (nohup sleep "$1" &>/dev/null && notify-send -u normal -w -a "Timer" "Timer complete: $1" &)
}

cpfn() {
  local filename="$1"

  realpath "$filename" | tr -d '\n' | wl-copy 
}

newmac() {
  openssl rand -hex 6 | sed 's/\(..\)\(..\)\(..\)\(..\)\(..\)\(..\)/\1:\2:\3:\4:\5:\6/'
}
